<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="keywords" content="footer, address, phone, icons" />
	<title>Day-One</title>
	<link href="{{ url_for('static', filename= 'images/l.jpg') }}" rel="icon">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/general.css') }}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
	<script src="{{ url_for('static', filename= 'js/g.js') }}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link href="http://fonts.googleapis.com/css?family=Cookie" rel="stylesheet" type="text/css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
	<link rel="stylesheet" href="{{ url_for('static', filename= 'css/globalStyling.css') }}">
	<script src="{{ url_for('static', filename= 'js/general.js') }}"></script>
	<script src="{{ url_for('static', filename= 'js/html5-qrcode.min.js') }}"></script>
	<link rel="stylesheet" href="{{ url_for('static', filename= 'css/parousiologio.css') }}">
</head>

<body style="padding-top:57px;">
	<div class="loader" id="loader"
		style="z-index:999;position:fixed;top:50%;left:50%;margin-top:-60px;margin-left:-60px;display:none;"></div>
	<div class="d-flex" id="wrapper">

		<!-- Sidebar Menu-->
		<ul id="contextMenu" class="dropdown-menu dropdown-menu-end" role="menu">
			<li><a class="dropdown-item disable-select" tabindex="-1" onclick="expandAll()">Πλήρη ανάπτυξη</a></li>
			<li><a class="dropdown-item disable-select" tabindex="-1" onclick="closeAll()">Πλήρη σύμπτηξη</a></li>
			<li class="dropdown-divider"></li>
			<li><a class="dropdown-item disable-select" tabindex="-1">Separated link</a></li>
		</ul>

		<!-- Sidebar-->
		<div class="border-end bg-light disable-select sideNav" id="sidebar-wrapper">
			<div style="display:none;">
				<div class="d-flex justify-content-center p-2" id="divIcons">
					<a href="/index" class="col-3 text-reset">
						<i class="bi bi-house-fill"></i>
					</a>
					<a href="#" class="col-3 text-reset">
						<i class="bi bi-gear-fill"></i>
					</a>
					<a href="#" class="col-3 text-reset">
						<i class="bi bi-person-fill"></i>
					</a>
					<a href="/logout" class="col-3 text-reset">
						<i class="bi bi-door-closed-fill"></i>
					</a>
				</div>
			</div>
			<div class="list-group sideList">
				<a>
					<div>
						<div class="accordion accordion-flush" id="FindocExpand">
							<div class="accordion-item">
								<h2 class="accordion-header" id="Findoc-headingOne">
									<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
										data-bs-target="#Findoc-collapseOne" aria-expanded="false"
										aria-controls="Findoc-collapseOne">
										<a><i class="bi bi-cash"></i> Εμπορική Διαχείρηση</a>
									</button>
								</h2>
								<div id="Findoc-collapseOne" class="accordion-collapse collapse"
									aria-labelledby="Findoc-headingOne" data-bs-parent="#FindocExpand">
									<div class="list-group">
										<a class="list-group-item list-group-item-action list-group-item-light p-2"
											href="#!"><i class="bi bi-card-list"></i> Πωλήσεις</a>
										<a class="list-group-item list-group-item-action list-group-item-light p-2"
											href="#!"><i class="bi bi-card-list"></i> Αγορές</a>
									</div>
								</div>
							</div>
						</div>
				</a>
				<a>
					<div class="accordion accordion-flush" id="TrdrExpand">
						<div class="accordion-item">
							<h2 class="accordion-header" id="Trdr-headingOne">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#Trdr-collapseOne" aria-expanded="false"
									aria-controls="Trdr-collapseOne">
									<a><i class="bi bi-people"></i> Συναλασσόμενοι</a>
								</button>
							</h2>
							<div id="Trdr-collapseOne" class="accordion-collapse collapse"
								aria-labelledby="Trdr-headingOne" data-bs-parent="#TrdrExpand">
								<div class="list-group">
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="/customers"><i class="bi bi-card-list"></i> Πελάτες</a>
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="#!"><i class="bi bi-card-list"></i> Προμηθευτές</a>
								</div>
							</div>
						</div>
					</div>
				</a>
				<a>
					<div class="accordion accordion-flush" id="CrmExpand">
						<div class="accordion-item">
							<h2 class="accordion-header" id="Crm-headingOne">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#Crm-collapseOne" aria-expanded="false"
									aria-controls="Crm-collapseOne">
									<a><i class="bi bi-pie-chart"></i> CRM</a>
								</button>
							</h2>
							<div id="Crm-collapseOne" class="accordion-collapse collapse"
								aria-labelledby="Crm-headingOne" data-bs-parent="#CrmExpand">
								<div class="list-group">
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="/calendar"><i class="bi bi-calendar-date"></i> Ημερολόγιο</a>
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="/meetings"><i class="bi bi-card-list"></i> Συναντήσεις</a>
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="#!"><i class="bi bi-list-task"></i> Εκρεμότητες</a>
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="#!"><i class="bi bi-telephone"></i> Κλήσεις</a>
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="#!"><i class="bi bi-calendar"></i> Εορτολόγιο</a>
									<a class="list-group-item list-group-item-action list-group-item-light p-2"
										href="#!"><i class="bi bi-check2-square"></i> Εγκρίσεις</a>
								</div>
							</div>
						</div>
					</div>
				</a>
				<a>
					<div>
						<a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!"><i
								class="bi bi-clock"></i> Ραντεβού</a>
						<a class="list-group-item list-group-item-action list-group-item-light p-3"
							href="/parousiologio"><i class="bi bi-book"></i> Παρουσιολόγιο</a>
					</div>
				</a>
			</div>
		</div>
	</div>

	<!-- Page content wrapper-->
	<div id="page-content-wrapper">

		<!-- Top navigation-->
		<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom fixed-top disable-select">
			<div class="container-fluid">

				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" aria-expanded="false"
					aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<button class="btn btn-outline-secondary" id="sidebarToggle"><span
							class="navbar-toggler-icon"></span></button>
					<ul class="navbar-nav ms-auto mt-2 mt-lg-0">

						<li class="nav-item"><a class="nav-link" href="/"><i class="bi bi-house-fill"></i>
								{{session['companyname']}}</a></li>

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button"
								data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i
									class="bi bi-person-fill"></i> {{session['username']}}</a>
							<div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
								<a class="dropdown-item" href="/"><i class="bi bi-house-fill"></i>
									{{session['companyname']}}</a>
								<a class="dropdown-item" href="#!"><i class="bi bi-person-fill"></i>
									{{session['username']}}</a>
								<a class="dropdown-item" href="#!"><i class="bi bi-gear-fill"></i> Settings</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="/logout"><i class="bi bi-door-closed-fill"></i>
									Αποσύνδεση</a>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<!-- Page content-->
		<div class="container-fluid disable-select qrFlex">

			<div class="d-flex justify-content-center mx-4">
				<p class="text-center">Σαρώστε το QR Code που βρίσκεται στην εταιρία σας.</p>
			</div>
			<div class="d-flex justify-content-center">
				<img src="{{ url_for('static', filename= 'images/qr.gif') }}"  style="width: 35%; height:auto;">
			</div>
			<div class="d-flex justify-content-center">
				<div class="align-self-center">
					<button class="btn btn-secondary my-3" id='OpenScan'><i class="bi bi-camera me-2"></i>Σάρωση QR
						Code</button>
				</div>
			</div>
			<!--CAMERA MODAL-->
			<div class="modal fade" tabindex="-1" role="dialog" id="cameraModal" aria-labelledby="exampleModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span id="cancelm2">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<div class="container-fluid">
								<div class="d-flex justify-content-center">
									<label>Σκάναρε το QR</label>
								</div>
								<div class="d-flex justify-content-center my-3">
									<div id="reader" width="600px" height="600px"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			{% if session['isadmin']=='1' %}
			<div>
				<div class="d-flex justify-content-center">
					<button class="btn btn-secondary" id="btnqrgen" onclick="generateQRCode()"><i
							class="bi bi-upc-scan me-2"></i>Παραγωγή QR Code</button>
				</div>

				<div class="d-flex justify-content-center">
					<canvas id="qr-code" style="display:none; width:200px; height:200px;"></canvas>
				</div>
			</div>
			{%endif%}
			<!--<script>
					$( "#OpenScan" ).click(function() {
						$( "#loader" ).css("display", "block");
						let scanner = new Instascan.Scanner({ video: document.getElementById('preview')});
						Instascan.Camera.getCameras().then(function(cameras){
							if(cameras.length > 0 ){
								scanner.start(cameras[1]);
								$('#cameraModal').modal('toggle');
								$( "#loader" ).css("display", "none");
							}else{
								$( "#loader" ).css("display", "none");
								alert('No cameras found');
							};
						}).catch(function(e) {
							$( "#loader" ).css("display", "none");
							alert(e);
						});

						scanner.addListener('scan',function(c){
							play();
							scanner.stop();
							$('#cameraModal').modal('hide');
							$( "#loader" ).css("display", "block");
							const d = new Date();
							dd= d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate()+" "+d.getHours()+":"+d.getMinutes();
							$.ajax({
								url: '/parousiologio/insert',
								method: "POST",
								data:{
									date:dd,
									qrcode:c
								},
								success: function (data) {
									if(data['success']){
										if(data['status']=='insert'){
											$( "#loader" ).css("display", "none");
											$('#successmodalWelcome').modal('toggle');
											setTimeout(function(){
											  $('#successmodalWelcome').modal('hide')
											}, 2000);
										}else if(data['status']=='update'){
											$( "#loader" ).css("display", "none");
											$('#successmodalBye').modal('toggle');
											setTimeout(function(){
											  $('#successmodalBye').modal('hide')
											}, 2000);
										}else if(data['status']=='qrcode'){
											$( "#loader" ).css("display", "none");
											$('#failuremodal').modal('toggle');
											setTimeout(function(){
											  $('#failuremodal').modal('hide')
											}, 2000);
										}
									}else{
									}
								}
							});
						});

						$("#cameraModal").on('hide.bs.modal', function(){
						  	scanner.stop();
						});

						function play() {
							var beepsound = new Audio('{{ url_for('static', filename= 'sounds/beep.mp3') }}');
							beepsound.play();
						}
					});
				</script>-->
			<script>
				$("#cancelm2").click(function () {
					$("#cameraModal").modal('hide');
				})

				$("#OpenScan").click(function () {
					$("#loader").css("display", "block");
					window.cameraId;
					window.html5QrCode = new Html5Qrcode("reader");
					const qrCodeSuccessCallback = (decodedText, decodedResult) => {
						play();
						$('#cameraModal').modal('hide');
						$("#loader").css("display", "block");
						const d = new Date();
						dd = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate() + " " + d.getHours() + ":" +
							d.getMinutes();
						$.ajax({
							url: '/parousiologio/insert',
							method: "POST",
							data: {
								date: dd,
								qrcode: decodedText
							},
							success: function (data) {
								if (data['success']) {
									if (data['status'] == 'insert') {
										$("#loader").css("display", "none");
										$('#successmodalWelcome').modal('toggle');
										setTimeout(function () {
											$('#successmodalWelcome').modal('hide')
										}, 2000);
									} else if (data['status'] == 'update') {
										$("#loader").css("display", "none");
										$('#successmodalBye').modal('toggle');
										setTimeout(function () {
											$('#successmodalBye').modal('hide')
										}, 2000);
									} else if (data['status'] == 'qrcode') {
										$("#loader").css("display", "none");
										$('#failuremodal').modal('toggle');
										setTimeout(function () {
											$('#failuremodal').modal('hide')
										}, 2000);
									}
								} else {}
							}
						});
					};
					Html5Qrcode.getCameras().then(devices => {
						/**
						 * devices would be an array of objects of type:
						 * { id: "id", label: "label" }
						 */
						if (devices && devices.length) {
							cameraId = devices[0].id;
							$("#loader").css("display", "none");
							$('#cameraModal').modal('toggle');
							const config = {
								fps: 10,
								qrbox: 250
							};
							html5QrCode.start({
								facingMode: "environment"
							}, config, qrCodeSuccessCallback);
						} else {
							$("#loader").css("display", "none");
							alert('Δεν βρέθηκε κάμερα');
						}
					}).catch(err => {
						$("#loader").css("display", "none");
						alert(err);
					});
				});



				//function onScanSuccess(decodedText, decodedResult) {
				//	// handle the scanned code as you like, for example:
				//	//console.log(`Code matched = ${decodedText}`, decodedResult);
				//	play();
				//	html5QrcodeScanner.clear();
				//	$('#cameraModal').modal('hide');
				//	$( "#loader" ).css("display", "block");
				//	const d = new Date();
				//	dd= d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate()+" "+d.getHours()+":"+d.getMinutes();
				//	$.ajax({
				//		url: '/parousiologio/insert',
				//		method: "POST",
				//		data:{
				//			date:dd,
				//			qrcode:decodedText
				//		},
				//		success: function (data) {
				//			if(data['success']){
				//				if(data['status']=='insert'){
				//					$( "#loader" ).css("display", "none");
				//					$('#successmodalWelcome').modal('toggle');
				//					setTimeout(function(){
				//					  $('#successmodalWelcome').modal('hide')
				//					}, 2000);
				//				}else if(data['status']=='update'){
				//					$( "#loader" ).css("display", "none");
				//					$('#successmodalBye').modal('toggle');
				//					setTimeout(function(){
				//					  $('#successmodalBye').modal('hide')
				//					}, 2000);
				//				}else if(data['status']=='qrcode'){
				//					$( "#loader" ).css("display", "none");
				//					$('#failuremodal').modal('toggle');
				//					setTimeout(function(){
				//					  $('#failuremodal').modal('hide')
				//					}, 2000);
				//				}
				//			}else{
				//			}
				//		}
				//	});
				//}

				$("#cameraModal").on('hide.bs.modal', function () {
					html5QrCode.stop().then((ignore) => {
						// QR Code scanning is stopped.
					}).catch((err) => {
						// Stop failed, handle it.
					});
				});

				function play() {
					var beepsound = new Audio("{{ url_for('static', filename= 'sounds / beep.mp3') }}");
					beepsound.play();
				}
			</script>

		</div>
	</div>
	<script>
		if ($('.navbar-toggler').css('display') == 'none') {} else {
			$('#sidebarToggle').css('display', 'none');
			$('#divIcons').parent().css('display', 'block');
		};

		$('.navbar-toggler').on('click', function () {
			$('#sidebarToggle').click();
		});
	</script>
	<!--MODALS-->
	<div class="disable-select">
		<!--Welcome-->
		<div class="modal fade" id="successmodalWelcome" role="dialog">
			<div class="modal-dialog modal-sm modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="modal-body">
						<div class="container">
							<div class="row">
								<div class="d-flex justify-content-center">
									<img src="{{ url_for('static', filename= 'images/Green-Tick.png') }}"
										style="width:50%">
								</div>
							</div>
							<div class="row">
								<div class="d-flex justify-content-center">
									<p style="font-size:20px">Επιτυχής καταχώρηση</p>
								</div>
							</div>
							<div class="row">
								<div class="d-flex justify-content-center">
									<h4><span id="insertID">Καλώς Ήρθατε </span></h4>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--BYE-->
		<div class="modal fade" id="successmodalBye" role="dialog">
			<div class="modal-dialog modal-sm modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="modal-body">
						<div class="container">
							<div class="row">
								<div class="d-flex justify-content-center">
									<img src="{{ url_for('static', filename= 'images/Green-Tick.png') }}"
										style="width:50%">
								</div>
							</div>
							<div class="row">
								<div class="d-flex justify-content-center">
									<p style="font-size:20px">Επιτυχής καταχώρηση</p>
								</div>
							</div>
							<div class="row">
								<div class="d-flex justify-content-center">
									<h4><span id="insertID">Καλό σας απόγευμα </span></h4>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--WrongE-->
		<div class="modal fade" id="failuremodal" role="dialog">
			<div class="modal-dialog modal-sm modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="modal-body">
						<div class="container">
							<div class="row">
								<div class="d-flex justify-content-center">
									<img src="{{ url_for('static', filename= 'images/Red-X.png') }}" style="width:50%">
								</div>
							</div>
							<div class="row">
								<div class="d-flex justify-content-center">
									<p style="font-size:20px">Κάτι πήγε στραβά</p>
								</div>
							</div>
							<div class="row">
								<div class="d-flex justify-content-center">
									<span id="insertIDFail">Παρακαλώ σκανάρετε το σωστό QRCode</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>

	<!-- Footer -->
	<footer class="bg-light border-top text-muted fixed-bottom d-flex justify-content-center p-2">
		<!-- Section: Social media -->
		<div>
			<a href="https://www.facebook.com/DayOne-1099718003526187/" target="_blank" class="me-4 text-reset">
				<i class="bi bi-facebook"></i>
			</a>
			<a href="" class="me-4 text-reset">
				<i class="bi bi-twitter"></i>
			</a>
			<a href="https://www.day-one.gr/" target="_blank" class="me-4 text-reset">
				<i class="bi bi-google"></i>
			</a>
			<a href="" class="me-4 text-reset">
				<i class="bi bi-instagram"></i>
			</a>
			<a href="https://www.linkedin.com/company/dayone-company" target="_blank" class="me-4 text-reset">
				<i class="bi bi-linkedin"></i>
			</a>
		</div>
		<!-- Section: Social media -->
	</footer>
	<!-- Footer -->
	<!-- Bootstrap core JS-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Core theme JS-->
	<script>
		var qr;
		(function () {
			qr = new QRious({
				element: document.getElementById('qr-code'),
				size: 300,
				value: "{{data['qrcode']}}"
			});
		})();

		function generateQRCode() {
			qr.set({
				foreground: 'black',
				size: 300,
				value: "{{data['qrcode']}}"
			});
			$('#qr-code').css("display", "block");
			$('#btnqrgen').css("display", "none");

		}
	</script>
</body>

</html>